require=function e(t,i,c){function r(s,a){if(!i[s]){if(!t[s]){var n="function"==typeof require&&require;if(!a&&n)return n(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){var i=t[s][1][e];return r(i?i:e)},h,h.exports,e,t,i,c)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<c.length;s++)r(c[s]);return r}({HelloWorld:[function(e,t,i){"use strict";cc._RFpush(t,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld"),cc.Class({"extends":cc.Component,properties:{label:{"default":null,type:cc.Label},text:"Hello, World!"},onLoad:function(){this.label.string=this.text},update:function(e){}}),cc._RFpop()},{}],game:[function(e,t,i){"use strict";cc._RFpush(t,"0aa3buExpRCBoxShj4kbC8n","game");var c=cc.Enum({NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4}),r=2,o=1;cc.Class({"extends":cc.Component,properties:{_touchStartPos:{"default":null,serializable:!1},_touching:{"default":!1,serializable:!1},floorLayerName:"floor",barrierLayerName:"barrier",objectGroupName:"players",startObjectName:"SpawnPoint",successObjectName:"SuccessPoint"},onLoad:function(){var e=this;e._player=e.node.getChildByName("player"),e._isMapLoaded||(e._player.active=!1),cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,i){e._onKeyPressed(t,i)}},e.node)},restart:function(){this._succeedLayer.active=!1,this._initMapPosition(),this._curTile=this._startTile,this._updatePlayerPos()},start:function(e){if(cc.log("Game start ...",e),!e){var t=this;t._initMapPosition(),this._succeedLayer=this.node.getParent().getChildByName("successedLayer"),this._succeedLayer.active=!1,t._tiledMap=t.node.getComponent(cc.TiledMap),cc.log(t._tiledMap);var i=t._tiledMap.getObjectGroup(t.objectGroupName);if(cc.log(i),i){var c=i.getObject(this.startObjectName),r=i.getObject(this.successObjectName);if(c&&r){var o=cc.p(c.sgNode.x,c.sgNode.y),s=cc.p(r.sgNode.x,r.sgNode.y);this._layerFloor=this._tiledMap.getLayer(this.floorLayerName),this._layerBarrier=this._tiledMap.getLayer(this.barrierLayerName),this._layerFloor&&this._layerBarrier&&(this._curTile=this._startTile=this._getTilePos(o),this._endTile=this._getTilePos(s),this._player&&(this._updatePlayerPos(),this._player.active=!0),this._isMapLoaded=!0)}}}},_initMapPosition:function(){this.node.setPosition(cc.visibleRect.bottomLeft)},_updatePlayerPos:function(){cc.log(this._curTile,this._curTile.x,this._curTile.y);var e=this._layerFloor.getPositionAt(this._curTile);this._player.setPosition(e)},_getTilePos:function(e){var t=this.node.getContentSize(),i=this._tiledMap.getTileSize(),c=Math.floor(e.x/i.width),r=Math.floor((t.height-e.y)/i.height);return cc.p(c,r)},_onKeyPressed:function(e,t){if(this._isMapLoaded&&!this._succeedLayer.active){var i=cc.p(this._curTile.x,this._curTile.y),r=c.NONE;switch(e){case cc.KEY.up:i.y-=1,r=c.DOWN;break;case cc.KEY.down:i.y+=1,r=c.UP;break;case cc.KEY.left:i.x-=1,r=c.RIGHT;break;case cc.KEY.right:i.x+=1,r=c.LEFT;break;default:return}this._tryMoveToNewTile(i,r)}},_tryMoveToNewTile:function(e,t){var i=this._tiledMap.getMapSize();if(!(e.x<0||e.x>=i.width||e.y<0||e.y>=i.height)){if(this._layerBarrier.getTileGIDAt(e))return cc.log("This way is blocked!"),!1;this._curTile=e,this._updatePlayerPos(),this._tryMoveMap(t),cc.pointEqualToPoint(this._curTile,this._endTile)&&(cc.log("succeed"),this._succeedLayer.active=!0)}},_tryMoveMap:function(e){var t,i=this.node.getContentSize(),s=this.node.getPosition(),a=this._player.getPosition(),n=cc.size(cc.visibleRect.width,cc.visibleRect.height),l=this._tiledMap.getTileSize(),h=r*l.width,u=r*l.height,d=a.x+s.x,p=a.y+s.y;switch(e){case c.UP:p<u&&(t=cc.p(s.x,s.y+l.height*o));break;case c.DOWN:n.height-p-l.height<u&&(t=cc.p(s.x,s.y-l.height*o));break;case c.LEFT:n.width-d-l.width<h&&(t=cc.p(s.x-l.width*o,s.y));break;case c.RIGHT:d<h&&(t=cc.p(s.x+l.width*o,s.y));break;default:return}if(t){var _=n.width-i.width-cc.visibleRect.left,y=cc.visibleRect.left.x,g=n.height-i.height-cc.visibleRect.bottom,f=cc.visibleRect.bottom.y;t.x<_&&(t.x=_),t.x>y&&(t.x=y),t.y<g&&(t.y=g),t.y>f&&(t.y=f),cc.pointEqualToPoint(t,s)||(cc.log("Move the map to new position: ",t),this.node.setPosition(t))}}}),cc._RFpop()},{}],loadScene:[function(e,t,i){"use strict";cc._RFpush(t,"28288gGFLBEnJ9ThlLL1LcH","loadScene"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){}}),cc._RFpop()},{}]},{},["HelloWorld","game","loadScene"]);